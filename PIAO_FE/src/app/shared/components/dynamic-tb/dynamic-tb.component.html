<div class="main">
  @if (title) {
    <p class="title">{{ title | translate }}</p>
  }
  @if (subTitle) {
    <p class="sub-title pt-4">{{ subTitle | translate }}</p>
  }

  <div class="row pt-3">
    @for (x of arrayForm?.controls; track $index) {
      @let i = $index + 1;
      @let lengthArray = arrayForm?.controls?.length;

      @let labelAndDescTool =
        isMongo && !modalType
          ? lengthArray > 1
            ? dynamicTBConfig.labelTB + ' ' + i
            : dynamicTBConfig.labelTB
          : modalType && isMongo
            ? x.controls[dynamicTBConfig.controlTBMongo]?.value || dynamicTBConfig.controlTBMongo
            : dynamicTBConfig.labelTB;
      <div [class]="columnClass">
        <div class="text-box-wrapper">
          <piao-text-box
            [label]="labelAndDescTool"
            [typeInput]="dynamicTBConfig.typeTB"
            [control]="x.controls[dynamicTBConfig.controlTB]"
            [id]="dynamicTBConfig.idTB"
            [inputClass]="dynamicTBConfig.classTB"
            [maxValidatorLength]="dynamicTBConfig.maxValidatorLengthTB"
            [descTooltip]="labelAndDescTool"
            [isLabelTranslate]="false"
            [containerClass]="'container-width-full'"
          ></piao-text-box>

          @if (isFirstRemove) {
            <p class="link-blue" (click)="handleOpenModalDelete($index)">
              {{ removeForm | translate }}
            </p>
          } @else if (!isFirstRemove && $index !== 0) {
            <p class="link-blue" (click)="handleOpenModalDelete($index)">
              {{ removeForm | translate }}
            </p>
          }
        </div>
      </div>
    }

    @if (arrayForm.controls.length === 0) {
      @if (notFoundMessage) {
        <p class="not-found">
          {{ notFoundMessage | translate }}
        </p>
      }
    }
  </div>
  @if (!showAddCardInfo && isAddButtonInContainer) {
    <p class="d-flex justify-content-end pt-4">
      <span class="link-blue" (click)="handleAddNewForm($index)">
        {{ addButton | translate }}
      </span>
    </p>
  }

  @if (showAddCardInfo) {
    <div class="pt-4">
      <piao-card-info
        [titleCardHeader]="titleCardInfo"
        [piaoCardHeaderTitleClass]="'title-card-info'"
        [titleLoadNewForm]="titleLoadNewForm"
        [loadNewForm]="true"
        [piaoCardHeaderContainerClass]="'piao-card-info-container-new-form'"
        (clicked)="handleClickNewForm()"
      ></piao-card-info>
    </div>
  }

  <piao-modal
    [isIcon]="true"
    [icon]="iconPencil"
    [iconStyle]="iconStyle"
    [open]="openModal"
    [disabledButtonConfirm]="disabledButtonConfirm"
    [titleButtonConfirm]="'BUTTONS.INSERT'"
    (closed)="this.openModal = false; this.child.formGroup.reset(); closed.emit()"
    (confirm)="handleAddNewForm(); this.child.formGroup.reset()"
  >
    @if (modalType && modalType === 'ulterioreInfo') {
      <piao-modal-new-field #child></piao-modal-new-field>
    }
  </piao-modal>
</div>

<piao-modal-delete
  [icon]="'AlertCircle'"
  [title]="'MODAL_REMOVE.TITLE'"
  [message]="'MODAL_REMOVE.MESSAGE'"
  [subMessage]="'MODAL_REMOVE.CONFIRM_OPERATION'"
  [openModalDelete]="openModalDelete"
  [elementToDelete]="elementToDelete"
  (confirm)="handleRemoveForm($event)"
  (closed)="handleCloseModalDelete()"
></piao-modal-delete>
