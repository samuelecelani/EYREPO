@for (
  obiettivo of obbiettiviPerformance.controls;
  track trackByObiettivoId($index, obiettivo);
  let i = $index
) {
  <div [ngClass]="i > 0 ? 'accordion-section-double' : 'accordion-section'">
    <piao-accordion
      [index]="i + 1"
      [title]="labelObiettivoPrefix | translate"
      [isOpen]="openAccordionIndex === i + 1"
      [isButton]="true"
      (clickButton)="handleOpenModalDelete(i)"
    >
      <div class="intro-text">
        <p>{{ labelIntroText | translate }}</p>
      </div>

      <div class="pt-3">
        <div class="container-full">
          <div class="row">
            <div class="col-12 col-xl-6">
              <piao-dropdown
                [title]="labelObiettivoVP | translate"
                [formControl]="obiettivo.controls['idOvp']"
                [dropdown]="ovpOptions"
                [isTooltip]="true"
                [dropContainerClass]="'container-width-full'"
                [isRequired]="true"
                (isChange)="handleOvpChange($event, i)"
              >
              </piao-dropdown>
            </div>

            <div class="col-12 col-xl-6">
              <piao-dropdown
                [title]="labelStrategiaOVP | translate"
                [formControl]="obiettivo.controls['idStrategiaOvp']"
                [dropdown]="strategieOptionsPerObiettivo[i] || []"
                [isTooltip]="true"
                [dropContainerClass]="'container-width-full'"
                [isRequired]="true"
                (isChange)="handleStrategiaChange($event, i)"
              >
              </piao-dropdown>
            </div>
          </div>

          <div class="row pt-3">
            <div class="col-12 col-xl-4">
              <piao-text-box
                [label]="labelIdObiettivo | translate"
                [typeInput]="'text'"
                [inputClass]="'input'"
                [control]="setCodice(obiettivo, i)"
                [maxValidatorLength]="50"
                [id]="'idObiettivo_' + i"
                [descTooltip]="labelIdObiettivo | translate"
                [isReadOnly]="true"
                [containerClass]="'container-width-full'"
              >
              </piao-text-box>
            </div>

            <div class="col-12 col-xl-4">
              <piao-text-box
                [label]="labelObiettivoPerformanceRispettoPA | translate"
                [typeInput]="'text'"
                [inputClass]="'input'"
                [control]="obiettivo.controls['denominazione']"
                [maxValidatorLength]="250"
                [id]="'denominazione_' + i"
                [descTooltip]="labelObiettivoPerformanceRispettoPA | translate"
                [required]="true"
                [containerClass]="'container-width-full'"
              >
              </piao-text-box>
            </div>

            <div class="col-12 col-xl-4">
              <piao-text-box
                [label]="labelResponsabileAmministrativo | translate"
                [typeInput]="'text'"
                [inputClass]="'input'"
                [control]="obiettivo.controls['responsabileAmministrativo']"
                [maxValidatorLength]="100"
                [id]="'responsabileAmministrativo_' + i"
                [descTooltip]="labelResponsabileAmministrativo | translate"
                [containerClass]="'container-width-full'"
              >
              </piao-text-box>
            </div>
          </div>

          <div>
            <piao-dynamic-tb-fields
              [formGroup]="obiettivo"
              [dynamicTBConfig]="contributoreConfig"
              [nameArrayForm]="'contributoreInterno.properties'"
              [containerInputClass]="'container-width-25'"
              [propertiesPath]="'contributoreInterno.properties'"
              [titleLabel]="
                'SEZIONE_22.OBIETTIVI_PERFORMANCE.OBIETTIVO.DETAILS.CONTRIBUTORI_INTERNI'
              "
              [notFoundLabel]="
                'SEZIONE_22.OBIETTIVI_PERFORMANCE.OBIETTIVO.DETAILS.NOT_FOUND_CONTRIBUTORI'
              "
              [addFieldLabel]="
                'SEZIONE_22.OBIETTIVI_PERFORMANCE.OBIETTIVO.DETAILS.ADD_CONTRIBUTORE'
              "
              [isTooltip]="true"
            >
            </piao-dynamic-tb-fields>
          </div>

          <div>
            <h3 class="section-title">{{ labelStakeholder | translate }}</h3>
            <div class="row pt-3">
              <div class="col-12 col-xl-4 col-lg-4">
                <piao-dropdown
                  [title]="labelSelezionaStakeholder | translate"
                  [formControl]="obiettivo.controls['stakeholders']"
                  [dropdown]="stakeholderOptions"
                  [isTooltip]="true"
                  [isMulti]="true"
                  [dropContainerClass]="'container-width-full'"
                >
                </piao-dropdown>
              </div>
            </div>
          </div>

          @if (tipologia === TipologiaObbiettivo.PERFORMANCE_ORGANIZZATIVA) {
            <div class="pt-3">
              <h3 class="section-title">{{ titlePianificazioneRisorse | translate }}</h3>
              <div class="pt-3">
                <div class="row">
                  <div class="col-12 col-xl-4">
                    <piao-text-box
                      [label]="labelRisorseUmane | translate"
                      [typeInput]="'text'"
                      [inputClass]="'input'"
                      [control]="obiettivo.controls['risorseUmane']"
                      [maxValidatorLength]="50"
                      [id]="'risorseUmane_' + i"
                      [descTooltip]="labelRisorseUmane | translate"
                      [containerClass]="'container-width-full'"
                    >
                    </piao-text-box>
                  </div>

                  <div class="col-12 col-xl-4">
                    <piao-text-box
                      [label]="labelRisorseFinanziarie | translate"
                      [typeInput]="'text'"
                      [inputClass]="'input'"
                      [control]="obiettivo.controls['risorseEconomicaFinanziaria']"
                      [maxValidatorLength]="250"
                      [id]="'risorseEconomicaFinanziaria_' + i"
                      [descTooltip]="labelRisorseFinanziarie | translate"
                      [containerClass]="'container-width-full'"
                    >
                    </piao-text-box>
                  </div>
                  <div class="col-12 col-xl-4">
                    <piao-text-box
                      [label]="labelRisorseStrumentali | translate"
                      [typeInput]="'text'"
                      [inputClass]="'input'"
                      [control]="obiettivo.controls['risorseStrumentali']"
                      [maxValidatorLength]="100"
                      [id]="'risorseStrumentali_' + i"
                      [descTooltip]="labelRisorseStrumentali | translate"
                      [containerClass]="'container-width-full'"
                    >
                    </piao-text-box>
                  </div>
                </div>
              </div>
            </div>
          }

          <div class="pt-2">
            <piao-indicatori
              [indicatoriControls]="obiettivo.controls['indicatori']"
              [codTipologiaFK]="codTipologiaFK"
              [idEntitaFK]="obiettivo.value.id || 0"
              [idSezione22]="idSezione22"
              [formParent]="obiettivo"
              [codTipologiaIndicatoreFK]="codTipologiaIndicatoreFK"
              [sectionEnum]="sectionEnum"
            ></piao-indicatori>
          </div>
        </div>
      </div>
    </piao-accordion>
  </div>
}

<div class="pt-4">
  <piao-card-info
    [titleCardHeader]="titleCardInfoObiettivo | translate"
    [piaoCardHeaderTitleClass]="'title-card-info'"
    [titleLoadNewForm]="subTitleAddObiettivo | translate"
    [loadNewForm]="true"
    [piaoCardHeaderContainerClass]="'piao-card-info-container-new-form'"
    (clicked)="handleAddObiettivo()"
  ></piao-card-info>
</div>

<piao-modal-delete
  [icon]="'AlertCircle'"
  [title]="'MODAL_REMOVE.TITLE'"
  [message]="'MODAL_REMOVE.MESSAGE'"
  [subMessage]="'MODAL_REMOVE.CONFIRM_OPERATION'"
  [openModalDelete]="openModalDelete"
  [elementToDelete]="elementToDelete"
  (confirm)="handleRemoveObiettivo($event)"
  (closed)="handleCloseModalDelete()"
></piao-modal-delete>
