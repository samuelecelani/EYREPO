@for (
  obiettivo of obiettivoPrev.controls;
  track trackByObiettivoId($index, obiettivo);
  let i = $index
) {
  <div [ngClass]="i > 0 ? 'accordion-section-double' : 'accordion-section'">
    <piao-accordion
      [index]="i + 1"
      [title]="labelObiettivoPrefix | translate"
      [isOpen]="openAccordionIndex === i + 1"
      [isButton]="true"
      (clickButton)="handleOpenModalDelete(i)"
    >
      <div class="intro-text">
        <p>{{ labelIntroText | translate }}</p>
      </div>

      <div class="pt-3">
        <div class="container-full">
          <div class="row">
            <div class="col-12 col-xl-4">
              <piao-dropdown
                [title]="labelOvpLabel | translate"
                [formControl]="obiettivo.controls['idOVP']"
                [dropdown]="ovpOptions"
                [isTooltip]="true"
                [dropContainerClass]="'container-width-full'"
                [isRequired]="true"
                (isChange)="handleOvpChange($event, i)"
              >
              </piao-dropdown>
            </div>

            <div class="col-12 col-xl-4">
              <piao-dropdown
                [title]="labelStrategiaOvpLabel | translate"
                [formControl]="obiettivo.controls['idStrategiaOVP']"
                [dropdown]="strategieOptionsPerObiettivo[i] || []"
                [isTooltip]="true"
                [dropContainerClass]="'container-width-full'"
                [isRequired]="true"
                (isChange)="handleStrategiaChange($event, i)"
              >
              </piao-dropdown>
            </div>

            <div class="col-12 col-xl-4">
              <piao-dropdown
                [title]="labelObiettivoPerformanceLabel | translate"
                [formControl]="obiettivo.controls['idObbiettivoPerformance']"
                [dropdown]="obiettiviPerformanceOptionsPerObiettivo[i] || []"
                [isTooltip]="true"
                [dropContainerClass]="'container-width-full'"
                [isRequired]="true"
                (isChange)="handleObiettivoPerformanceChange($event, i)"
              >
              </piao-dropdown>
            </div>
          </div>

          <div class="row pt-3">
            <div class="col-12 col-xl-4">
              <piao-text-box
                [label]="labelCodice | translate"
                [typeInput]="'text'"
                [inputClass]="'input'"
                [control]="setCodice(obiettivo, i)"
                [maxValidatorLength]="50"
                [id]="'idObiettivo_' + i"
                [descTooltip]="labelCodice | translate"
                [isReadOnly]="true"
                [containerClass]="'container-width-full'"
              >
              </piao-text-box>
            </div>

            <div class="col-12 col-xl-4">
              <piao-text-box
                [label]="labelDenominazione | translate"
                [typeInput]="'text'"
                [inputClass]="'input'"
                [control]="obiettivo.controls['denominazione']"
                [maxValidatorLength]="250"
                [id]="'denominazione_' + i"
                [descTooltip]="labelDenominazione | translate"
                [required]="true"
                [containerClass]="'container-width-full'"
              >
              </piao-text-box>
            </div>

            <div class="col-12 col-xl-4">
              <piao-text-box
                [label]="labelDescrizione | translate"
                [typeInput]="'text'"
                [inputClass]="'input'"
                [control]="obiettivo.controls['descrizione']"
                [maxValidatorLength]="100"
                [id]="'descrizione_' + i"
                [descTooltip]="labelDescrizione | translate"
                [containerClass]="'container-width-full'"
              >
              </piao-text-box>
            </div>
          </div>

          <div class="pt-2">
            <piao-indicatori
              [indicatoriControls]="obiettivo.controls['indicatori']"
              [codTipologiaFK]="codTipologiaFK"
              [idEntitaFK]="obiettivo.value.id || 0"
              [formParent]="obiettivo"
              [codTipologiaIndicatoreFK]="codTipologiaIndicatoreFK"
              [sectionEnum]="sectionEnum"
            ></piao-indicatori>
          </div>
        </div>
      </div>
    </piao-accordion>
  </div>
}

<div class="pt-4">
  <piao-card-info
    [titleCardHeader]="
      (obiettivoPrev.length === 0 ? labelNotFoundCardInfo : labelCardInfo) | translate
    "
    [piaoCardHeaderTitleClass]="'title-card-info'"
    [titleLoadNewForm]="labelAddObiettivo | translate"
    [loadNewForm]="true"
    [piaoCardHeaderContainerClass]="'piao-card-info-container-new-form'"
    (clicked)="handleAddObiettivo()"
  ></piao-card-info>
</div>

<piao-modal-delete
  [icon]="'AlertCircle'"
  [title]="'MODAL_REMOVE.TITLE'"
  [message]="'MODAL_REMOVE.MESSAGE'"
  [subMessage]="'MODAL_REMOVE.CONFIRM_OPERATION'"
  [openModalDelete]="openModalDelete"
  [elementToDelete]="elementToDelete"
  (confirm)="handleRemoveObiettivo($event)"
  (closed)="handleCloseModalDelete()"
></piao-modal-delete>
